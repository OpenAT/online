<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data noupdate="0">

        <!-- SUBTEMPLATE: Checkout Pages Header -->
        <template id="wsd_checkout_pages_header" name="Checkout Pages Custom Header and Checkout-Step-Indicator">
            <t t-set="one_page_checkout" t-value="website.one_page_checkout if website and website.one_page_checkout else one_page_checkout"/>

            <!-- Page Header and Checkout-Step-Indicator -->
            <div class="row wsd_checkout_pages_header">
                <div class="col-md-12" id="wsd_checkout_steps_nav">

                    <!-- Checkout Step Indicator, Back Button and Login Button -->
                    <div class="navbar checkout_steps_navigation" role="navigation">

                        <!-- Checkout-Step-Indicator -->
                        <!-- HINT: opc_payment() always adds one_page_checkout=True therefore we check if we are on the payment_page also -->
                        <t t-if="payment_page or not one_page_checkout">
                            <ul class="checkout_steps_indicator nav nav-tabs navbar-left">
                                <li role="presentation" t-att-class="'cart active' if cart_page else 'cart'">
                                    <a href="/shop/cart"><span t-esc="website.cart_indicator"/></a>
                                </li>
                                <li role="presentation" t-att-class="'checkout active' if checkout_page else 'checkout'">
                                    <a href="/shop/checkout"><span t-esc="website.checkout_indicator"/></a>
                                </li>
                                <li role="presentation" t-att-class="'payment disabled active' if payment_page else 'payment disabled'">
                                    <a href="#"><span t-esc="website.payment_indicator"/></a>
                                </li>
                                <li role="presentation" t-att-class="'confirmation disabled active' if confirmation_page else 'confirmation disabled'">
                                    <a href="#"><span t-esc="website.confirmation_indicator"/></a>
                                </li>
                            </ul>
                        </t>

                        <!-- Back-to-Page and Login/Logout Button -->
                        <div class="checkout_steps_buttons nav navbar-right">
                            <t t-call="website_sale_donate.wsd_button_back_to_page">
                                <t t-set="wsd_button_back_to_page" t-value="'btn btn-default navbar-btn'"/>
                            </t>
                            <t t-call="website_sale_donate.wsd_button_login_logout">
                                <t t-set="wsd_button_login_logout" t-value="'btn btn-primary navbar-btn'"/>
                            </t>
                        </div>
                    </div>
                </div>

                <!-- Page Header -->
                <div class="col-md-12" id="wsd_checkout_steps_header">
                    <t t-if="cart_page and website.cart_page_header"><h1 t-esc="website.cart_page_header"/></t>
                    <t t-if="checkout_page and website.checkout_page_header"><h1 t-esc="website.checkout_page_header"/></t>
                    <t t-if="payment_page and website.payment_page_header"><h1 t-esc="website.payment_page_header"/></t>
                    <t t-if="confirmation_page and website.confirmation_page_header"><h1 t-esc="website.confirmation_page_header"/></t>
                </div>
            </div>

            <!-- Top Snippet Dropping Area -->
            <div class="row wsd_checkout_pages_snippets_top">
                <div class="col-md-12">
                    <t t-if="cart_page"><div t-field="website.cart_page_top"/></t>
                    <t t-if="checkout_page"><div t-field="website.checkout_page_top"/></t>
                    <t t-if="payment_page"><div t-field="website.payment_page_top"/></t>
                    <t t-if="confirmation_page"><div t-field="website.confirmation_page_top"/></t>
                </div>
            </div>
        </template>


        <!-- ============= -->
        <!-- SHOPPING CART -->
        <!-- ============= -->

        <!-- INHERIT SUB-TEMPLATE total: Hide Tax if 0 -->
        <template id="wsd_total" inherit_id="website_sale.total">
            <xpath expr="//tr[@id='order_total_taxes']" position="attributes">
                <attribute name="class"></attribute>
                <attribute name="t-att-class">'text-muted' if website_sale_order and website_sale_order.amount_tax else 'text-muted hidden'</attribute>
            </xpath>
        </template>

        <!-- INHERIT SUB-TEMPLATE cart_delivery: Hide Delivery if 0 -->
        <template id="wsd_total_delivery" inherit_id="website_sale_delivery.cart_delivery">
            <xpath expr="//tr[@id='order_delivery']" position="attributes">
                <attribute name="class"></attribute>
                <attribute name="t-att-class">'text-muted' if website_sale_order and website_sale_order.amount_delivery else 'text-muted hidden'</attribute>
            </xpath>
        </template>

        <!-- INHERIT SHOPPING CART -->
        <template id="wsd_cart_extended" inherit_id="website_sale.cart" name="Product-Cart Extensions">

            <!-- Custom Page-Headline and Checkout-Step-Indicator and top Snippet-Dropping-Area -->
            <xpath expr="//ul[@class='wizard pull-right']" position="attributes">
                <attribute name="t-if">False</attribute>
            </xpath>
            <xpath expr="//h1[@class='mb32']" position="attributes">
                <attribute name="t-if">False</attribute>
            </xpath>
            <xpath expr="//h1[@class='mb32']" position="after">
                <t t-call="website_sale_donate.wsd_checkout_pages_header">
                    <t t-set="cart_page" t-value="True"/>
                </t>
            </xpath>

            <!-- Bottom Snippet-Dropping-Area (below cart) -->
            <xpath expr="//div[@class='container oe_website_sale']/div[@class='row'][1]" position="after">
                <div class="row wsd_cart_page_bottom">
                    <div class="col-md-12">
                        <div t-field="website.cart_page_bottom"/>
                    </div>
                </div>
            </xpath>

            <!-- SHOPPING CART ADJUSTMENTS -->
            <!-- Add category to shopping cart products -->
            <xpath expr="//a[@t-attf-href='/shop/product/#{ slug(line.product_id.product_tmpl_id) }']" position="replace">
                <t t-set="line_cat" t-value="str(line.cat_id.id if line.cat_id else line.cat_root_id.id if line.cat_root_id else False)"/>
                <a t-att-href="'' if line.product_id.do_not_link else '/shop/product/'+slug(line.product_id.product_tmpl_id)+('?category='+line_cat if line_cat else '')">
                    <span t-esc="line.product_id.with_context(display_default_code=False).display_name"/>
                </a>
            </xpath>

            <!-- Add payment interval as text under the product price -->
            <xpath expr="//table[@id='cart_products']//td[@name='price']" position="inside">
                <t t-if="line.payment_interval_id">
                    <div class="small text-muted text-right">(<t t-esc="line.payment_interval_id.name"/>)</div>
                </t>
            </xpath>

            <!-- Do not show Sales order line text in shopping cart! (Because of two bugs: Bug 1: False if none Bug2: english language) -->
            <xpath expr="//table[@id='cart_products']//div[@class='text-muted']" position="replace">
                    <div class="hidden"> </div>
            </xpath>

            <!-- Hide list price in shopping cart if price_donate -->
            <xpath expr="//td[@name='price']//del[@class='text-danger']" position="attributes">
                <attribute name="t-if">not line.product_id.price_donate</attribute>
            </xpath>

            <!-- Hide price if 0 and show word free instead -->
            <xpath expr="//td[@name='price']//span[@t-field]" position="attributes">
                <attribute name="style"/>
                <attribute name="t-att-style">'white-space: nowrap;' if line.discounted_price != 0 else 'display: none;'</attribute>
            </xpath>
            <xpath expr="//td[@name='price']//span[@t-field]" position="after">
                <span t-if="line.discounted_price == 0" class="line_discounted_price_free">free</span>
            </xpath>

            <!-- Change the product quantity controls (oe_website_spinner) -->
            <xpath expr="//table[@id='cart_products']//div[@class='input-group oe_website_spinner']" position="replace">
                <!-- Product Quantity Selector -->
                <div class="cart_controls">
                    <div class="input-group oe_website_spinner pull-left">
                        <span class="input-group-addon">
                            <a t-attf-href="#"
                               t-att-class="'mb8 js_add_cart_json disabled' if line.product_id.hide_quantity else 'mb8 js_add_cart_json'"
                               data-no-instant="">
                                <i class="fa fa-minus"></i>
                            </a>
                        </span>

                        <input type="text"
                               class="js_quantity form-control"
                               t-att-disabled="line.product_id.hide_quantity"
                               t-att-data-line-id="line.id"
                               t-att-data-product-id="line.product_id.id"
                               t-att-value="int(line.product_uom_qty)"/>

                        <span class="input-group-addon">
                            <a t-attf-href="#"
                               t-att-class="'mb8 float_left disabled' if line.product_id.hide_quantity else 'mb8 float_left js_add_cart_json'"
                               data-no-instant="">
                                <i class="fa fa-plus"></i>
                            </a>
                        </span>

                    </div>
                    <!-- Remove Product Button -->
                    <a href="#" class="remove_product"
                       t-att-data-line-id="line.id">
                        <span class="glyphicon glyphicon-remove"/>
                    </a>
                </div>
            </xpath>

            <!-- Replace Continue-to-Checkout Button -->
            <xpath expr="//a[@href='/shop/checkout']" position="attributes">
                <attribute name="t-if">False</attribute>
            </xpath>
            <xpath expr="//a[@href='/shop/checkout']" position="after">
                <a t-if="not optional_products and website_sale_order and website_sale_order.website_order_line"
                   class="btn btn-primary pull-right" href="/shop/checkout">
                    <t t-if="website.button_cart_to_data">
                       <span t-field="website.button_cart_to_data"/>
                    </t>
                    <t t-if="not website.button_cart_to_data">
                       Continue
                    </t>
                    &amp;nbsp;<span class="glyphicon glyphicon-chevron-right"/>
                </a>
            </xpath>
        </template>

        <!-- INHERIT CONTINUE SHOPPING OPTION: OPTION: Better Back Button -->
        <template id="wsd_continue_shopping" inherit_id="website_sale.continue_shopping" customize_show="True" active="True" name="Back_to_Shop Button">
            <xpath expr="//a[@href='/shop']" position="replace">
                <!-- Back-to-Page Button -->
                <t t-call="website_sale_donate.wsd_button_back_to_page">
                    <t t-set="wsd_button_back_to_page" t-value="'btn btn-default'"/>
                </t>
            </xpath>
        </template>


        <!-- ============= -->
        <!-- CHECKOUT PAGE -->
        <!-- ============= -->

        <!-- SUBTEMPLATE Checkout Billing Fields -->
        <template id="wsd_checkout_form_billing_fields" name="wsd checkout-form-billing-fields">
            <t t-set="website_sale_order" t-value="website.sale_get_order()"/>

            <!-- BILLING ADDRESS FORM GENERATOR -->
            <t t-foreach="billing_fields or []" t-as="billing_field">
                <t t-if="billing_field.show">
                    <t t-set="css_classes" t-value="billing_field.css_classes"/>
                    
                    <!-- Render field as snippet-dropping-area -->
                    <t t-if="not billing_field.res_partner_field_id">
                        <div t-att-class="css_classes if css_classes else 'col-lg-12'">
                            <div t-field="billing_field.information" class="oe_structure billing_field_snippet"/>
                            <t t-if="billing_field.clearfix">
                                <div class="clearfix"/>
                            </t>
                        </div>
                    </t>
                
                    <!-- Render field as field -->
                    <t t-if="billing_field.res_partner_field_id">
                        <t t-set="f_name" t-value="billing_field.res_partner_field_id.name"/>
                        <t t-set="f_type" t-value="billing_field.res_partner_field_id.ttype"/>
                        <t t-set="validation_rule" t-value="{}"/>
                        <t t-if="billing_field.validation_rule">
                            <t t-set="validation_rule" t-value="dict(item.split('=') for item in billing_field.validation_rule.split(';'))"/>
                        </t>
                        
                        <!-- FIELD GENERATORS: BILLING FIELDS -->
                        <t t-if="f_type in ('boolean', 'char', 'selection', 'date') or f_name in ['country_id', 'state_id']">
                            <!-- FORM GROUP -->
                            <div t-att-class="'form-group has-feedback ' + css_classes + ' f-type-' + f_type + ((' has-error ' + error.get(f_name)) if error.get(f_name) else '')">
                                
                                <!-- ALL FIELD TYPES: LABEL -->
                                <label t-att-class="'control-label f-' + f_name + (' mandatory text-danger' if billing_field.mandatory else '')"
                                       t-att-for="f_name">
                                    <!-- BOOLEAN FIELDS -->
                                    <t t-if="f_type == 'boolean'">
                                        <input type="checkbox"
                                               t-att-name="f_name"
                                               t-att-value="checkout.get(f_name)"
                                               t-att-checked="True if checkout.get(f_name) else ''"
                                               t-att-required="billing_field.mandatory"/>
                                    </t>
                                    <t t-raw="billing_field.label"/>
                                </label>
                                
                                <!-- ALL FIELD TYPES: MODAL BOX -->
                                <t t-if="billing_field.information">
                                    <!-- Modal Box Button-Link -->
                                    <href type="button"
                                            class="btn-link information-modal-box-trigger"
                                            data-toggle="modal"
                                            t-att-data-target="'#information-'+f_name">
                                        <span class="glyphicon glyphicon-info-sign"/>
                                    </href>
                                    <!-- Modal Box -->
                                    <div class="modal fade"
                                         t-att-id="'information-'+f_name"
                                         role="dialog">
                                        <div class="modal-dialog">
                                            <!-- Modal content-->
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close"
                                                            data-dismiss="modal">&amp;times;</button>
                                                    <h4 class="modal-title">
                                                        <t t-raw="billing_field.label"/>
                                                    </h4>
                                                </div>
                                                <div class="modal-body">
                                                    <t t-raw="billing_field.information"/>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-default" data-dismiss="modal">
                                                        Close
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                                
                                <!-- CHAR FIELDS -->
                                <t t-if="f_type == 'char'">
                                    <input type="text"
                                           t-att-name="f_name"
                                           class="form-control"
                                           t-att-value="checkout.get(f_name) if not billing_field.nodata else ''"
                                           t-att-placeholder="billing_field.placeholder"
                                           t-att-required="billing_field.mandatory"
                                           t-att="validation_rule"
                                    />
                                </t>
                                
                                <!-- DATE FIELDS -->
                                <t t-if="f_type == 'date'">
                                    <t t-set="date_de"
                                       t-value="datetime.datetime.strftime(datetime.datetime.strptime(checkout.get(f_name),'%Y-%m-%d'), '%d.%m.%Y') if checkout.get(f_name) else None"
                                    />
                                    <input type="text"
                                           t-att-name="f_name"
                                           class="form-control"
                                           t-att-value="date_de if not billing_field.nodata else ''"
                                           t-att-placeholder="billing_field.placeholder"
                                           t-att-required="billing_field.mandatory"
                                           t-att="validation_rule"
                                    />
                                </t>
                                
                                <!-- SELECTION FIELDS -->
                                <t t-if="f_type == 'selection'">
                                    
                                    <!--<select t-att-name="f_name" -->
                                            <!--class="form-control"-->
                                            <!--t-att-required="billing_field.mandatory">-->
                                        <!--&lt;!&ndash; Default empty option &ndash;&gt;-->
                                        <!--<option value=""><t t-esc="billing_field.placeholder"/></option>-->
                                        <!--&lt;!&ndash; Selection Values as options &ndash;&gt;-->
                                        <!--<t t-foreach="request.env['res.partner']._columns[f_name].selection or []" t-as="option">-->
                                            <!--&lt;!&ndash; Set default country from res.config if none selected &ndash;&gt;-->
                                            <!--<option t-att-value="option[0]"-->
                                                    <!--t-att-selected="True if checkout.get(f_name) == option[0] else ''">-->
                                                <!--<t t-esc="dict(request.env['res.partner'].fields_get([f_name])[f_name]['selection'])[option[0]]"/>-->
                                            <!--</option>-->
                                        <!--</t>-->
                                    <!--</select>-->
                                    
                                    <!-- Selection Field: List Style -->
                                    <t t-if="billing_field.style == 'selection' or not billing_field.style">
                                        <select t-att-id="f_name"
                                                t-att-name="f_name"
                                                class="form-control"
                                                t-att-required="billing_field.mandatory">
                                            <!-- Default empty option -->
                                            <option value=""><t t-esc="billing_field.placeholder"/></option>
                                            <!-- Selection Values as options -->
                                            <t t-foreach="request.env['res.partner']._columns[f_name].selection or []" t-as="option">
                                                <!-- Create Option List -->
                                                <option t-att-value="option[0]"
                                                        t-att-selected="True if checkout.get(f_name) == option[0] and not billing_field.nodata else ''">
                                                    <t t-esc="dict(request.env['res.partner'].fields_get([f_name])[f_name]['selection'])[option[0]]"/>
                                                </option>
                                            </t>
                                        </select>
                                    </t>

                                    <!-- Selection Field: Radio Buttons Style -->
                                    <t t-if="billing_field.style in ('radio', 'radio_selectnone')">
                                        <t t-if="billing_field.style == 'radio_selectnone'">
                                            <div class="radio">
                                                <label>
                                                    <input type="radio"
                                                           t-att-id="f_name + '_noselection'"
                                                           t-att-name="f_name"
                                                           value=""
                                                           t-att-checked="True if not partner[f_name] and not checkout.get(f_name) else None"
                                                    />
                                                    <t t-esc="billing_field.placeholder or 'No Selection'"/>
                                                </label>
                                            </div>
                                        </t>
                                        <t t-foreach="request.env['res.partner']._columns[f_name].selection or []" t-as="option">
                                            <div class="radio">
                                                <label>
                                                    <input type="radio"
                                                           t-att-id="option[0]"
                                                           t-att-name="f_name"
                                                           t-att-value="option[0]"
                                                           t-att-checked="True if checkout.get(f_name) == option[0] and not billing_field.nodata else None"
                                                    />
                                                    <t t-esc="dict(request.env['res.partner'].fields_get([f_name])[f_name]['selection'])[option[0]]"/>
                                                </label>
                                            </div>
                                        </t>
                                    </t>                                    
                                    
                                    
                                </t>
                                
                                <!-- Special field rendered as selection: country_id -->
                                <t t-if="f_name == 'country_id'">
                                    <select t-att-name="f_name"
                                            class="form-control"
                                            t-att-required="billing_field.mandatory">
                                        <option value=""><t t-esc="billing_field.placeholder"/></option>
                                        <t t-foreach="countries or []" t-as="country">
                                            <!-- Set default country from res.config if none selected -->
                                            <option t-att-value="country.id"
                                                    t-att-selected="'True' if not billing_field.nodata and (country.id == checkout.get('country_id') or (country.id != checkout.get('country_id') and country.code == website.country_default_value.code)) else ''">
                                                <t t-esc="country.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </t>
                                
                                <!-- Special field rendered as selection: state_id -->
                                <t t-if="f_name == 'state_id'">
                                    <select t-att-name="f_name"
                                            class="form-control"
                                            t-att-required="billing_field.mandatory">
                                        <option value=""><t t-esc="billing_field.placeholder"/></option>
                                        <t t-foreach="states or []" t-as="state">
                                            <option t-att-value="state.id" style="display:none;"
                                                    t-att-data-country_id="state.country_id.id"
                                                    t-att-selected="True if state.id == checkout.get('state_id') and not billing_field.nodata else None">
                                                <t t-esc="state.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </t>
                                
                            </div>
                        </t>
    
                        <!-- CLEARFIX DIV -->
                        <t t-if="billing_field.clearfix">
                            <div t-att-class="'clearfix clearfix-' + f_name"/>
                        </t>
                    </t>
                    
                </t>
            </t>

            <!-- SHIPPING ADDRESS SELECTOR -->
            <div t-att-class="'hidden' if website.hide_shipping_address else ''">
                <!-- Correct an odoo Bug? Shipping Address is always shown after the first call of payment -->
                <t t-if="website_sale_order and (website_sale_order.partner_shipping_id.id == website_sale_order.partner_invoice_id.id)">
                    <t t-set="shipping_id" t-value="0"/>
                </t>

                <div class="clearfix shipping-address-selector"/>
                <div class="form-group has-feedback col-lg-12">
                    <label>Shipping</label>
                    <select name="shipping_id" class="form-control">
                        <option value="0">
                            Ship to the same address
                        </option>
                        <t t-if="shippings">
                            <t t-foreach="shippings" t-as="shipping">
                                <!-- HINT: shippings_selector_attrs.get(shipping.id) is a dict {attr: value, attr: value } -->
                                <option t-att-value="shipping.id"
                                        t-att-selected="shipping.id == shipping_id"
                                        t-att="shippings_selector_attrs.get(shipping.id)">
                                    <t t-esc="', '.join('\n'.join(shipping.name_get()[0][1].split(',')).split('\n')[1:])"/>
                                </option>
                            </t>
                        </t>
                        <option value="-1"
                                t-att-selected="error and len(error) > 0 and shipping_id == -1">
                            -- Create a new address --
                        </option>
                    </select>
                </div>
            </div>
        </template>


        <!-- SUBTEMPLATE Checkout Shipping Fields -->
        <!-- HINT: Field names are prefixed with shipping_ -->
        <template id="wsd_checkout_form_shipping_fields" name="wsd checkout-form-shipping-fields">
            <t t-set="website_sale_order" t-value="website.sale_get_order()"/>

            <!-- SHIPPING ADDRESS FORM GENERATOR -->
            <t t-foreach="shipping_fields or []" t-as="shipping_field">
                <t t-set="f_name" t-value="'shipping_' + shipping_field.res_partner_field_id.name"/>
                <t t-set="f_type" t-value="shipping_field.res_partner_field_id.ttype"/>
                <t t-set="css_classes" t-value="shipping_field.css_classes"/>
                <t t-set="validation_rule" t-value="{}"/>
                <t t-if="shipping_field.validation_rule">
                    <t t-set="validation_rule" t-value="dict(item.split('=') for item in shipping_field.validation_rule.split(';'))"/>
                </t>

                <t t-if="shipping_field.show">

                    <!-- FIELD GENERATORS: SHIPPING FIELDS -->
                    <!-- HINT: Because of a "stupid decision" in website_sale.js inputs must use readonly and selects must use disabled :( -->
                    <t t-if="f_type in ('boolean', 'char', 'selection') or f_name in ['shipping_country_id', 'shipping_state_id']">
                        <!-- FORM GROUP -->
                        <div t-att-class="'form-group has-feedback ' + css_classes + ((' has-error ' + error.get(f_name)) if error.get(f_name) else '')">
                            <!-- LABEL for all fields -->
                            <label t-att-class="'control-label f-' + f_name + (' mandatory text-danger' if shipping_field.mandatory else '')"
                                   t-att-for="f_name">
                                <!-- BOOLEAN FIELDS -->
                                <t t-if="f_type == 'boolean'">
                                    <input type="checkbox"
                                           t-att-name="f_name"
                                           t-att-value="checkout.get(f_name)"
                                           t-att-checked="True if checkout.get(f_name) else ''"
                                           t-att-readonly="'readonly' if shipping_id &gt;= 0 else ''"
                                           t-att-required="shipping_field.mandatory"/>
                                </t>
                                <t t-esc="shipping_field.label"/>
                                <!-- TODO: Info modal box -->
                            </label>
                            <!-- CHAR FIELDS -->
                            <t t-if="f_type == 'char'">
                                <input type="text"
                                       t-att-name="f_name"
                                       class="form-control"
                                       t-att-value="checkout.get(f_name, '')"
                                       t-att-placeholder="shipping_field.placeholder"
                                       t-att-readonly="'readonly' if shipping_id &gt;= 0 else ''"
                                       t-att-required="shipping_field.mandatory"
                                       t-att="validation_rule"
                                />
                            </t>
                            <!-- DATE FIELDS -->
                            <t t-if="f_type == 'date'">
                                <t t-set="date_de"
                                   t-value="datetime.datetime.strftime(datetime.datetime.strptime(checkout.get(f_name),'%Y-%m-%d'), '%d.%m.%Y') if checkout.get(f_name) else ''"
                                />
                                <input type="text"
                                       t-att-name="f_name"
                                       class="form-control"
                                       t-att-value="date_de"
                                       t-att-placeholder="shipping_field.placeholder"
                                       t-att-readonly="'readonly' if shipping_id &gt;= 0 else ''"
                                       t-att-required="shipping_field.mandatory"
                                       t-att="validation_rule"
                                />
                            </t>
                            <!-- SELECTION FIELDS -->
                            <!-- TODO: option to render selection fields as radio buttons too
                                 HINT: not possible for shipping address right now because website_sale.js resets value attribute of input fields
                                       (look for look for: $(this).val( data[$(this).attr("name")] || "" );
                            -->
                            <t t-if="f_type == 'selection'">
                                <select t-att-name="f_name" class="form-control"
                                        t-att-required="shipping_field.mandatory"
                                        t-att-disabled="'disabled' if shipping_id &gt;= 0 else ''">
                                    <option value=""><t t-esc="shipping_field.placeholder"/></option>
                                    <t t-foreach="request.env['res.partner']._columns[shipping_field.res_partner_field_id.name].selection or []" t-as="option">
                                        <!-- Set default country from res.config if none selected -->
                                        <option t-att-value="option[0]"
                                                t-att-selected="True if checkout.get(f_name) == option[0] else ''">
                                            <t t-esc="dict(request.env['res.partner'].fields_get([shipping_field.res_partner_field_id.name])[shipping_field.res_partner_field_id.name]['selection'])[option[0]]"/>
                                        </option>
                                    </t>
                                </select>
                            </t>
                            <!-- SPECIAL FIELD: SHIPPING COUNTRY -->
                            <t t-if="f_name == 'shipping_country_id'">
                                <select t-att-name="f_name" class="form-control"
                                        t-att-required="shipping_field.mandatory"
                                        t-att-disabled="'disabled' if shipping_id &gt;= 0 else ''">
                                    <option value=""><t t-esc="shipping_field.placeholder"/></option>
                                    <t t-foreach="countries or []" t-as="country">
                                        <!-- Set default country from res.config if none selected -->
                                        <option t-att-value="country.id"
                                                t-att-selected="'True' if (country.id == checkout.get(f_name) or (country.id != checkout.get(f_name) and country.code == website.country_default_value.code)) else ''">
                                            <t t-esc="country.name"/>
                                        </option>
                                    </t>
                                </select>
                            </t>
                            <!-- SPECIAL FIELD: SHIPPING STATE -->
                            <t t-if="f_name == 'shipping_state_id'">
                                <select t-att-name="f_name" class="form-control"
                                        t-att-required="shipping_field.mandatory"
                                        t-att-disabled="'disabled' if shipping_id &gt;= 0 else ''">
                                    <option value=""><t t-esc="shipping_field.placeholder"/></option>
                                    <t t-foreach="states or []" t-as="state">
                                        <option t-att-value="state.id" style="display:none;"
                                                t-att-data-country_id="state.country_id.id"
                                                t-att-selected="state.id == checkout.get(f_name)">
                                            <t t-esc="state.name"/>
                                        </option>
                                    </t>
                                </select>
                            </t>
                        </div>
                    </t>

                    <!-- CLEARFIX DIV -->
                    <t t-if="shipping_field.clearfix">
                        <div t-att-class="'clearfix clearfix-' + f_name"/>
                    </t>
                </t>
            </t>
        </template>


        <!-- SUBTEMPLATE Display Invoice Address Data based on Billing or Shipping Fields -->
        <template id="wsd_fields_display" name="wsd_fields_display">
            <t t-if="address_obj and fields_to_render">
                <!-- Loop through the fields -->
                <t t-foreach="fields_to_render or []" t-as="f">
                    <t t-if="f.show">
                        <t t-set="f_name" t-value="f.res_partner_field_id.name"/>
                        <t t-set="f_type" t-value="f.res_partner_field_id.ttype"/>
                        <t t-set="css_classes" t-value="f.css_classes"/>

                        <t t-if="f_type == 'char' or f_name in ['country_id', 'state_id']">
                            <!-- Get Field Value -->
                            <t t-set="f_value" t-value="getattr(address_obj, f_name, '')"/>
                            <!-- Overwrite with Country Name -->
                            <t t-if="f_name == 'country_id'">
                                <t t-set="f_value" t-value="address_obj.country_id.name"/>
                            </t>
                            <!-- Overwrite with State Name -->
                            <t t-if="f_name == 'state_id'">
                                <t t-set="f_value" t-value="address_obj.state_id.name"/>
                            </t>
                            <!-- Render the Field -->
                            <span t-att-class="f_name" t-esc="f_value"/>
                            <!-- CLEARFIX DIV -->
                            <t t-if="f.clearfix">
                                <div t-att-class="'clearfix ' + f_name"/>
                            </t>
                        </t>
                    </t>
                </t>
            </t>
        </template>


        <!-- SUBTEMPLATE: Payment-Provider Auto Submit Form -->
        <template id="wsd_pp_auto_submit_form" name="Payment Provider Auto-Submit-Form">
            <!-- REDIRECT TO PAYMENT PROVIDER Auto-Submit-Form: Finally redirect to payment-provider if all data is correct -->
            <t t-if="acquirer_auto_submit">
                <t t-if="website.payment_redirection_message"><div t-raw="website.payment_redirection_message"/></t>
                <div t-raw="acquirer_auto_submit.button"
                     id="wsd_pp_auto_submit_form"
                     class="js_auto_submit_form"
                />
            </t>
        </template>

        <!-- SUBTEMPLATE ONE-PAGE-CHECKOUT: Payment-Method (Acquirers) and Delivery-Method Selection -->
        <template id="wsd_opc_payment" name="Payment One-Page-Checkout">
            <t t-set="website_sale_order" t-value="website.sale_get_order()"/>
            <t t-set="one_page_checkout" t-value="website.one_page_checkout or one_page_checkout"/>

            <!-- DELIVERY Options -->
            <div t-if="deliveries"
                 t-att-class="'row wsd_opc_delivery hidden' if website.hide_delivery_methods else 'row wsd_opc_delivery'"
                 t-att-id="'delivery_carrier' if not one_page_checkout else ''">
                <!-- Header: Delivery -->
                <div class="col-lg-12">
                    <h3 class="delivery_title">
                        <t t-if="website.delivery_title"><span t-field="website.delivery_title"/></t>
                        <t t-if="not website.delivery_title">Delivery</t>
                    </h3>
                </div>
                <div class="col-lg-12">
                    <ul class="list-unstyled">
                        <li t-foreach="deliveries" t-as="delivery">
                            <t t-if="delivery.available">
                                <label>
                                    <input t-att-value="delivery.id" type="radio" name="delivery_type"
                                        t-att-checked="order.carrier_id and order.carrier_id.id == delivery.id and 'checked' or False"/>
                                    <span t-field="delivery.name"/>
                                    <span class="badge" t-field="delivery.price"
                                        t-field-options='{
                                            "widget": "monetary",
                                            "from_currency": "delivery.product_id.company_id.currency_id",
                                            "display_currency": "website_sale_order.currency_id"
                                        }'/>
                                    <div t-field="delivery.website_description" class="text-muted"/>
                                </label>
                            </t>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- PAYMENT Method Selection -->
            <div class="row js_payment wsd_opc_payment" t-if="acquirers" id="payment_method">
                <!-- Header: Payment -->
                <div class="col-lg-12">
                    <h3 class="payment_title">
                        <t t-if="website.payment_title"><span t-field="website.payment_title"/></t>
                        <t t-if="not website.payment_title">Payment</t>
                    </h3>
                </div>
                <div class="col-lg-12">

                    <!-- Payment Page Errors -->
                    <t t-foreach="errors" t-as="error">
                        <div class="alert alert-danger" t-if="error">
                            <h4>
                                <t t-esc="error[0]"/>
                            </h4>
                            <t t-esc="error[1]"/>
                        </div>
                    </t>

                    <!-- Acquirer-Selection: input elements and images (icons) -->
                    <!-- http://getbootstrap.com/components/#btn-groups -->
                    <!-- http://getbootstrap.com/javascript/#buttons -->
                    <!-- http://getbootstrap.com/components/#nav-tabs -->
                    <!-- http://stackoverflow.com/questions/34677186/html-form-with-bootstrap-togglabe-tabs-by-radio-buttons -->

                    <!-- Get valid acquirer_id for default selection -->
                    <t t-set="acquirer_id" t-value="acquirer or acquirer_id"/>
                    <t t-set="first_valid_acquirer_id" t-value="False"/>
                    <t t-foreach="acquirers or []" t-as="acquirer">
                        <t t-if="acquirer.button and ((website_sale_order and (website_sale_order.has_recurring and acquirer.recurring_transactions)) or (website_sale_order and (not website_sale_order.has_recurring)))">
                            <!-- Set default acquirer if set and valid -->
                            <t t-if="website.acquirer_default and str(website.acquirer_default.id) == str(acquirer.id)">
                                <t t-set="first_valid_acquirer_id" t-value="acquirer.id"/>
                            </t>
                            <!-- Overwrite default acquirer with acquirer from post -->
                            <t t-if="(not first_valid_acquirer_id) or str(acquirer.id) == str(acquirer_id)">
                                <t t-set="first_valid_acquirer_id" t-value="acquirer.id"/>
                            </t>
                        </t>
                    </t>
                    <t t-set="acquirer_id" t-value="first_valid_acquirer_id"/>

                    <!-- Acquirer-Selection (Payment Method) Tabs -->
                    <ul class="nav nav-tabs" role="tablist">
                        <t t-foreach="acquirers or []" t-as="acquirer">
                            <!-- Only show correct acquirers for recurring payments if set -->
                            <t t-if="acquirer.button and ( (website_sale_order and (website_sale_order.has_recurring and acquirer.recurring_transactions)) or (website_sale_order and (not website_sale_order.has_recurring)) )">
                                <li role="presentation"
                                    t-att-class="'active' if str(acquirer.id) == str(acquirer_id) else ''"
                                    t-att-data-recurring-transactions="'True' if acquirer.recurring_transactions else 'False'">
                                    <a t-att-href="'#aq' + str(acquirer.id)" t-att-aria-controls="'aq' + str(acquirer.id)" role="tab" data-toggle="tab">
                                        <!-- Hidden Input Radio Tag -->
                                        <input type="radio" name="acquirer" class="tab-acquirer-input hidden" autocomplete="off"
                                               t-att-data-input-id="'aq' + str(acquirer.id)"
                                               t-att-value="acquirer.id"
                                               t-att-checked="str(acquirer.id) == str(acquirer_id)"
                                        />
                                        <!-- Acquirer Icon or Default Image -->
                                        <span class="tab-acquirer-image">
                                            <t t-if="not acquirer.acquirer_icon">
                                                <span>
                                                    <img t-if="not acquirer.acquirer_icon" class="media-object"
                                                         t-att-title="acquirer.name"
                                                         t-att-src="'/payment_%s/static/src/img/%s_icon.png' % (acquirer.provider, acquirer.provider)"/>
                                                </span>
                                            </t>
                                            <t t-if="acquirer.acquirer_icon">
                                                <span t-field="acquirer.acquirer_icon"
                                                      t-field-options='{"widget": "image", "class": "media-object"}'/>
                                            </t>
                                        </span>
                                        <!-- Acquirer Name -->
                                        <span class="tab-acquirer-name" t-field="acquirer.name"/>
                                    </a>
                                </li>
                            </t>
                        </t>
                    </ul>

                    <!-- Acquirer-Selection Tab Content -->
                    <div class="tab-content tab-equal-heights">
                        <t t-foreach="acquirers or []" t-as="acquirer">
                            <!-- Only show correct acquirers (payment methods) -->
                            <t t-if="acquirer.button and ((website_sale_order and (website_sale_order.has_recurring and acquirer.recurring_transactions)) or (website_sale_order and (not website_sale_order.has_recurring)))">
                                <div role="tabpanel"
                                     t-att-class="'tab-pane fade in active' if str(acquirer.id) == str(acquirer_id) else 'tab-pane fade'"
                                     t-att-id="'aq' + str(acquirer.id)"
                                     t-att-data-id="acquirer.id"
                                     t-att-data-recurring-transactions="'True' if acquirer.recurring_transactions else 'False'">

                                    <!-- Check for product page overwrites -->
                                    <t t-set="product_overwrite" t-value="False"/>
                                    <t t-if="product and product.product_acquirer_lines_ids">
                                        <t t-foreach="product.product_acquirer_lines_ids" t-as="pac_line">
                                            <t t-if="pac_line.acquirer_pre_msg and pac_line.acquirer_id.id == acquirer.id">
                                                <t t-set="product_overwrite" t-value="True"/>
                                                <div t-field="pac_line.acquirer_pre_msg" class="acquirer_pre_msg"/>
                                            </t>
                                        </t>

                                    </t>

                                    <t t-if="not product_overwrite">
                                        <div t-field="acquirer.pre_msg" class="acquirer_pre_msg"/>
                                    </t>

                                    <t t-if="one_page_checkout">
                                        <div t-raw="acquirer.button_opc"/>
                                    </t>
                                    <t t-if="not one_page_checkout">
                                        <div class="acquirer_button_not_opc" t-att-data-id="acquirer.id" t-raw="acquirer.button"/>
                                    </t>
                                </div>
                            </t>
                        </t>
                    </div>
                </div>

            </div>

        </template>

        <!-- SUBTEMPLATE: CHECKOUT FORM INSIDE -->
        <template id="wsd_checkout_form_inside" name="WSD Checkout Form Inside">
            <!-- HINT: if acquirer_auto_submit is in the qcontext it means we will only redirect to the pp and that's it
                       no need to render anything at this stage (see website_sale_donate main.py around line 576)
            -->
            <t t-if="not acquirer_auto_submit">
                <!-- OPC Warnings -->
                <t t-if="opc_warnings">
                    <div class="row opc_warnings">
                        <div class="col-md-12">
                            <t t-foreach="opc_warnings" t-as="opc_warning">
                                <h3>
                                    <t t-esc="opc_warning"/>
                                </h3>
                            </t>
                        </div>
                    </div>
                </t>

                <!-- Billing and Shipping -->
                <div class="row">


                    <!-- Header: "Your Data" -->
                    <t t-if="website.checkout_title">
                        <div class="col-md-12">
                            <h3 class="checkout_title">
                                <span t-field="website.checkout_title"/>
                                <!-- Logout Button for OPC Pages -->
                                <t t-if="website.user_id != user_id and one_page_checkout">
                                    <a class="btn btn-default wsd_button_opc_logout"
                                       t-attf-href="/web/session/logout?redirect=#{ request.httprequest.base_url }">
                                        <t t-if="not website.button_logout">Logout</t>
                                        <t t-if="website.button_logout"><span t-field="website.button_logout"/></t>
                                    </a>
                                </t>
                            </h3>
                        </div>
                    </t>
                    <!-- Billing Fields and Shipping-Address-Selector -->
                    <!-- HINT: the divs for the bootstrap columns are the fields div's -->
                    <div class="col-md-12">
                        <div class="row billing-fields">
                            <t t-call="website_sale_donate.wsd_checkout_form_billing_fields"/>
                        </div>
                    </div>
                    <!-- Shipping Fields (hidden if ship to same address) -->
                    <div t-att-class="'col-md-12 hidden' if (website.hide_shipping_address) else 'col-md-12'">
                        <div class="row js_shipping shipping-fields"
                             t-att-style="'display:none' if (not shipping_id) or (website_sale_order and (website_sale_order.partner_shipping_id.id == website_sale_order.partner_invoice_id.id)) else ''">
                            <!-- HINT: the divs for the bootstrap columns are the field div's -->
                            <t t-call="website_sale_donate.wsd_checkout_form_shipping_fields"/>
                        </div>
                    </div>
                </div>


                <!-- One-Page-Checkout: Acquirer, Delivery-Method, Auto-Submit-Form -->
                <t t-if="one_page_checkout">
                    <t t-call="website_sale_donate.wsd_opc_payment"/>
                </t>

                <!-- Back and Submit Buttons -->
                <t t-if="not hide_wsd_cfi_buttons">
                    <div class="clearfix">
                        <!-- Back-To-Page Button -->
                        <t t-call="website_sale_donate.wsd_button_back_to_page">
                            <t t-set="wsd_button_back_to_page" t-value="'btn btn-default'"/>
                        </t>

                        <!-- Button Submit-Checkout-Form (button_data_to_payment) -->
                        <a class="btn btn-primary pull-right a-submit" id="wsd_checkout_form_submit_button">
                            <t t-if="website.button_data_to_payment">
                               <span t-field="website.button_data_to_payment"/>
                            </t>
                            <t t-if="not website.button_data_to_payment">
                               Confirm
                            </t>
                            &amp;nbsp;<span class="glyphicon glyphicon-chevron-right"/>
                        </a>
                    </div>
                </t>
            </t>
        </template>

        <!-- SUBTEMPLATE: CHECKOUT FORM -->
        <template id="wsd_checkout_form" name="WSD Checkout Form">
            <t t-set="one_page_checkout" t-value="website.one_page_checkout or one_page_checkout"/>
            <form t-att-action="'/shop/checkout' if one_page_checkout else '/shop/confirm_order'"
                  method="post"
                  id="wsd_checkout_form">
                <!-- Separate template case we use it in checkout box too -->
                <!-- HINT: one_page_checkout already set above -->
                <t t-call="website_sale_donate.wsd_checkout_form_inside"/>
            </form>
            <!-- Include Payment-Provider Auto-Submit-Form -->
            <t t-call="website_sale_donate.wsd_pp_auto_submit_form"/>
        </template>

        <!-- INHERIT: CHECKOUT PAGE -->
        <template id="wsd_checkout" inherit_id="website_sale.checkout" name="WSD Checkout-Page Changes">

            <!-- DISABLE original checkout page elements -->
            <xpath expr="//ul[@class='wizard pull-right']" position="attributes">
                <attribute name="t-if">False</attribute>
            </xpath>
            <xpath expr="//h1[1]" position="attributes">
                <attribute name="t-if">False</attribute>
            </xpath>
            <xpath expr="//form[@action='/shop/confirm_order']" position="attributes">
                <attribute name="t-if">False</attribute>
            </xpath>

            <!-- CHECKOUT PAGE -->
            <xpath expr="//div[@class='container oe_website_sale']" position="inside">

                <!-- Custom Page-Headline and Checkout-Step-Indicator and top Snippet-Dropping-Area -->
                <t t-call="website_sale_donate.wsd_checkout_pages_header">
                    <t t-set="checkout_page" t-value="True"/>
                </t>

                <!-- Content -->
                <div class="row wsd_checkout_page_content">
                    <!-- Right Column: small cart (must float to top) -->
                    <div class="col-md-3 col-md-offset-1 col-md-push-8" id="wsd_checkout_page_right_column">
                        <!-- Small Cart -->
                        <t t-set="website_sale_order" t-value="website.sale_get_order()"/>
                        <t t-call="website_sale_donate.small_cart_header">
                            <!-- Always Show Small-Cart Header -->
                            <t t-set="show_small_cart_header" t-value="True"/>
                        </t>
                        <t t-call="website_sale_donate.small_cart">
                            <!-- HINT: Written this way to allow setting options via xpath -->
                        </t>
                    </div>
                    <!-- Left Column: checkout form -->
                    <div class="col-md-8 col-md-pull-4" id="wsd_checkout_page_left_column">
                        <!-- Checkout Form -->
                        <t t-call="website_sale_donate.wsd_checkout_form"/>
                    </div>
                </div>

                <!-- Bottom Snippet-Dropping-Area -->
                <div class="row wsd_checkout_page_bottom">
                    <div class="col-md-12">
                        <div t-field="website.checkout_page_bottom"/>
                    </div>
                </div>
            </xpath>

        </template>



        <!-- ============= -->
        <!-- PAYMENT PAGE  -->
        <!-- ============= -->

        <!-- INHERIT PAYMENT -->
        <template id="wsd_payment" inherit_id="website_sale.payment" name="WSD Payment Page">


            <!-- DISABLE original payment page elements -->
            <xpath expr="//div[@class='container oe_website_sale']" position="attributes">
                <attribute name="t-if">False</attribute>
            </xpath>

            <!-- Custom Payment Page -->
            <xpath expr="//div[@id='wrap']" position="inside">
                <div class="container oe_website_sale">

                    <!-- Payment-Provider Auto-Submit-Form -->
                    <t t-if="acquirer_auto_submit">
                        <div class="container">
                            <div class="row one-page-checkout ppt_opc-checkout">
                                <div class="col-md-12">
                                    <t t-call="website_sale_donate.wsd_pp_auto_submit_form"/>
                                </div>
                            </div>
                        </div>
                    </t>

                    <t t-if="not acquirer_auto_submit">
                        <!-- Custom Page-Headline and Checkout-Step-Indicator and top Snippet-Dropping-Area -->
                        <t t-call="website_sale_donate.wsd_checkout_pages_header">
                            <t t-set="payment_page" t-value="True"/>
                        </t>

                        <!-- Content -->
                        <div class="row wsd_payment_page_content">

                            <!-- Left Column -->
                            <div class="col-sm-8">
                                <!-- Small Cart -->
                                <t t-set="website_sale_order" t-value="website.sale_get_order()"/>
                                <t t-call="website_sale_donate.small_cart_header">
                                    <!-- Always Show Small-Cart Header -->
                                    <t t-set="show_small_cart_header" t-value="True"/>
                                </t>
                                <t t-call="website_sale_donate.small_cart">
                                    <t t-set="disable_changing_products" t-value="True"/>
                                    <t t-set="show_download_links" t-value="True"/>
                                </t>

                                <!-- Acquirer (Payment-Method) and Delivery-Method Form -->
                                <form action="/shop/payment"
                                      class="payment_opc_acquirer_form"
                                      method="POST">

                                    <!-- Acquirer and Delivery -->
                                    <t t-call="website_sale_donate.wsd_opc_payment">
                                        <t t-set="one_page_checkout" t-value="True"/>
                                    </t>

                                    <!-- Submit Button -->
                                    <a id="button_paynow" class="btn btn-primary btn-xl mt16 a-submit" href="#">
                                        <t t-if="website.payment_page_submit_button">
                                            <span t-field="website.payment_page_submit_button"/>
                                        </t>
                                        <t t-if="not website.payment_page_submit_button">
                                            <span>Pay Now!</span>
                                        </t>
                                    </a>

                                </form>


                            </div>

                            <!-- Right Column -->
                            <div class="col-sm-3 col-sm-offset-1">
                                <!-- Billing Address -->
                                <div class="payment_billing_address">
                                    <h4>Bill To:</h4>
                                    <!--<div t-field="order.partner_invoice_id"-->
                                         <!--t-field-options='{-->
                                         <!--"widget": "contact",-->
                                         <!--"fields": ["address", "name", "phone", "email"]-->
                                         <!--}'/>-->
                                    <div class="row billing_address">
                                        <div class="col-sm-12">
                                            <t t-call="website_sale_donate.wsd_fields_display">
                                                <t t-set="address_obj" t-value="order.partner_invoice_id"/>
                                                <t t-set="fields_to_render" t-value="billing_fields"/>
                                            </t>
                                        </div>
                                    </div>
                                    <div>
                                      <a href="/shop/checkout"><span class="fa fa-arrow-right"/> Change Address</a>
                                    </div>
                                </div>
                                <!-- Shipping Address -->
                                <t t-if="not website.hide_shipping_address">
                                    <div class="payment_shipping_address">
                                        <h4>Ship To:</h4>
                                        <t t-if="website_sale_order and (website_sale_order.partner_shipping_id and website_sale_order.partner_shipping_id.id != website_sale_order.partner_invoice_id.id)">
                                              <!--<div t-field="order.partner_shipping_id"-->
                                                   <!--t-field-options='{-->
                                                   <!--"widget": "contact",-->
                                                   <!--"fields": ["address", "name", "phone"]-->
                                                   <!--}'/>-->
                                            <div class="row shipping_address">
                                                <div class="col-sm-12">
                                                    <t t-call="website_sale_donate.wsd_fields_display">
                                                        <t t-set="address_obj" t-value="order.partner_shipping_id"/>
                                                        <t t-set="fields_to_render" t-value="shipping_fields"/>
                                                    </t>
                                                </div>
                                            </div>
                                        </t>
                                        <address t-if="website_sale_order and (website_sale_order.partner_shipping_id.id == website_sale_order.partner_invoice_id.id)">Ship to the same address</address>
                                        <div>
                                          <a href="/shop/checkout"><span class="fa fa-arrow-right"/> Change Address</a>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>

                        <!-- Bottom Snippet-Dropping-Area -->
                        <div class="row wsd_payment_page_bottom">
                            <div class="col-md-12">
                                <div t-field="website.payment_page_bottom"/>
                            </div>
                        </div>
                    </t>

                </div>
            </xpath>

        </template>


        <!-- ================== -->
        <!-- CONFIRMATION PAGE  -->
        <!-- ================== -->

        <!-- INHERIT: CONFIRMATION: Headline appears on separate line -->
        <template id="wsd_product_item" inherit_id="website_sale.confirmation" name="Confirmation Free Heading">
            <xpath expr="//ul[@class='wizard pull-right']" position="after">
                <div class="clearfix mb32"></div>
            </xpath>
        </template>

        <!-- ALTERNATIVE CHECKOUT PAGE !!! replaced default checkout page !!! see override of /shop/payment/validate -->
        <template id="confirmation_static">
            <t t-call="website.layout">
                <t t-set="additional_title">Shop - Confirmed</t>

                <div id="wrap">
                    <div class="container wsd_confirmation_page">
                        <!-- Top Snippet-Dropping-Area -->
                        <div class="row wsd_confirmation_page_top">
                            <div class="col-md-12">
                                <div t-field="website.confirmation_page_top"/>
                            </div>
                        </div>

                        <!-- Order and Payment status -->
                        <div class="row wsd_confirmation_page_status">
                            <div class="col-md-12">
                                <!-- Order Status -->
                                <t t-if="order">
                                    <h3 class="your_transaction_number">
                                        <span>Your Transaction Number</span>
                                    </h3>
                                    <h1 class="order_name">
                                        <span t-field="order.name"/>
                                    </h1>
                                    <!-- TODO: pack this in a field website.transaction_reference_info -->
                                    <div class="transaction_reference_info" t-field="website.confirmation_transaction_reference_info"/>
                                    <t t-if="order.payment_tx_id">
                                        <div class="payment_information">
                                            <h3>Payment Information</h3>
                                            <p class="payment_status">
                                                <div class="payment_status"><span>Payment Method: </span><span class="badge" t-field="order.payment_tx_id.acquirer_id"/></div>
                                                <div class="payment_status"><span>Payment Reference: </span><span class="badge" t-field="order.payment_tx_id.reference"/></div>
                                                <div class="payment_status"><span>Payment Status: </span><span class="badge" t-field="order.payment_tx_id.state"/></div>
                                                <div class="payment_status"><span>Total Amount: </span><span class="badge" t-field="order.amount_total"/></div>
                                            </p>
                                        </div>
                                    </t>
                                </t>
                                <!-- Error -->
                                <t t-if="not order">
                                    <h2 class="order_error">
                                        <span>No data received from the payment provider.</span>
                                    </h2>
                                </t>
                            </div>
                        </div>

                        <!-- Payment Acquirer post message -->
                        <t t-if="order and order.payment_tx_id and order.payment_tx_id.acquirer_id and order.payment_tx_id.acquirer_id.post_msg">
                            <div class="row wsd_acquirer_post_msg">
                                <div class="col-md-12">
                                        <div class="acquirer_post_msg" t-field="order.payment_tx_id.acquirer_id.post_msg"/>
                                </div>
                            </div>
                        </t>

                        <!-- Product Template confirmation_post_message(s) -->
                        <div class="row wsd_product_post_msg">
                            <div class="col-md-12">
                                <!-- Todo: Cycle through so lines products and show product_post_msg if not empty
                                           Create a new controller for product.template and show ist product_post_msg
                                           field so it can be filled and designed with snippets
                                -->
                            </div>
                        </div>

                        <!-- Bottom Snippet-Dropping-Area -->
                        <div class="row wsd_confirmation_page_bottom">
                            <div class="col-md-12">
                                <div t-field="website.confirmation_page_bottom"/>
                            </div>
                        </div>
                    </div>
                </div>

            </t>
        </template>
        
        <!-- INHERIT confirmation_static: Display download list and buttons -->
        <template id="confirmation_static_downloadfile" inherit_id="confirmation_static" name="Show Downloads" customize_show="True" active="False">
            <xpath expr="//div[@class='payment_information']" position="after">
                
                <!-- Search for product_downloads -->
                <t t-set="product_downloads" t-value="[line for line in order.order_line if line.product_id and (line.product_id.webshop_download_file or line.product_id.product_tmpl_id.webshop_download_file)]"/>
                
                <!-- Create download list -->
                <t t-if="product_downloads">
                    <div class="product_downloads">
                        <h3>Your Downloads</h3>
                        <p>
                            <ul>
                                <t t-foreach="product_downloads" t-as="line">
                                    
                                    <!-- Set download link from product.template -->
                                    <t t-if="line.product_id.product_tmpl_id.webshop_download_file">
                                        <t t-set="product_download_link" t-value="'/web/binary/saveas?model=product.template&amp;field=webshop_download_file&amp;filename_field=webshop_download_file_name&amp;id=%s' % line.product_id.product_tmpl_id.id"/>
                                        <t t-set="product_download_name" t-value="'%s' % line.product_id.product_tmpl_id.webshop_download_file_name"/>
                                    </t>
                                    <!-- Overwrite download link from product.product -->
                                    <t t-if="line.product_id.webshop_download_file">
                                        <t t-set="product_download_link" t-value="'/web/binary/saveas?model=product.product&amp;field=webshop_download_file&amp;filename_field=webshop_download_file_name&amp;id=%s' % line.product_id.id"/>
                                        <t t-set="product_download_name" t-value="'%s' % line.product_id.webshop_download_file_name"/>
                                    </t>
                                    
                                    <!-- Create list entry -->
                                    <li>
                                        <span class="product_download_line_name">
                                            <t t-esc="line.name"/>:&amp;nbsp;
                                        </span>
                                        <a class="product_download_line_button btn btn-xs btn-default"
                                           t-att-href="product_download_link">
                                            <span class="product_download_line_button_icon glyphicon glyphicon-download"/>
                                            <span class="product_download_line_button_name" t-esc="product_download_name"/>
                                        </a>
                                    </li>
                                    
                                </t>
                            </ul>
                        </p>
                    </div>
                </t>
                
            </xpath>
        </template>

    </data>
</openerp>
